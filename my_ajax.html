<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Products Management CRUD</title>
    <style>
      h2 {
        text-align: center;
        font-size: 30px;
      }
      .content {
        width: 80%;
        float: left;
      }
      div {
        padding: 10px;
      }
    </style>

    <script>
      window.onload = function () {
        let btnPro = document.getElementById("btnPro");
        let btnAdd = document.getElementById("btnAdd");
        getProducts();
        btnPro.addEventListener("click", function (event) {
          getProducts();
        });
        btnAdd.addEventListener("click", function (event) {
          event.preventDefault();
          postData();
        });
      };

      function getProducts() {
        const xhr = new XMLHttpRequest();
        xhr.open("GET", "https://jsonplaceholder.typicode.com/posts");
        xhr.setRequestHeader("content-type", "application/json");
        xhr.send();

        xhr.onload = () => {
          if (xhr.status === 200) {
            const res = JSON.parse(xhr.response);
            document.getElementById("contents").innerHTML = makeList(
              res.slice(0, 10)
            ); // 처음 10개의 데이터만 표시
          } else {
            console.log(xhr.status, xhr.statusText);
          }
        };
      }

      function postData() {
        let name = document.getElementById("name").value;
        let price = document.getElementById("price").value;

        const xhr = new XMLHttpRequest();
        xhr.open("POST", "https://jsonplaceholder.typicode.com/posts");
        xhr.setRequestHeader("content-type", "application/json; charset=UTF-8");
        const data = {
          title: name, // name 대신 title 필드 사용
          body: price, // price 대신 body 필드 사용
          userId: 1,
        };
        xhr.send(JSON.stringify(data));

        xhr.onload = () => {
          if (xhr.status === 201) {
            console.log("Product added:", JSON.parse(xhr.response)); // 성공 메시지
            getProducts(); // 새 데이터를 가져와 업데이트
          } else {
            console.log(xhr.status, xhr.statusText);
          }
        };
      }

      function makeList(data) {
        let str = "<ul>";
        data.forEach((item) => {
          str +=
            "<li> Title: " + item.title + " | Body: " + item.body + "</li>";
          str +=
            "<button onclick='updateForm(" +
            item.id +
            ', "' +
            item.title +
            '", "' +
            item.body +
            "\")'>Modify</button>" +
            "<button onclick='deleteData(" +
            item.id +
            ")'>Delete</button>";
        });
        str += "</ul>";
        return str;
      }

      function updateForm(id, currentTitle, currentBody) {
        let updateForm = `
        <div id="updateForm">
          <input type="text" id="m_name" placeholder="New Title" value="${currentTitle}" />
          <input type="text" id="m_price" placeholder="New Body" value="${currentBody}" />
          <button onclick="updateData(${id})">Modify</button>
          <button id="cancelButton" onclick="cancelUpdate()">Cancel</button>
        </div>
      `;
        document.getElementById("contents").innerHTML += updateForm;
      }

      function cancelUpdate() {
        document.getElementById("updateForm").remove();
      }

      function updateData(id) {
        let title = document.getElementById("m_name").value;
        let body = document.getElementById("m_price").value;

        const xhr = new XMLHttpRequest();
        xhr.open("PUT", "https://jsonplaceholder.typicode.com/posts/" + id);
        xhr.setRequestHeader("content-type", "application/json; charset=UTF-8");
        const data = {
          title: title,
          body: body,
          userId: 1,
        };
        xhr.send(JSON.stringify(data));

        xhr.onload = () => {
          if (xhr.status === 200) {
            console.log("Product updated:", JSON.parse(xhr.response)); // 성공 메시지
            getProducts();
          } else {
            console.log(xhr.status, xhr.statusText);
          }
        };
      }

      function deleteData(id) {
        const xhr = new XMLHttpRequest();
        xhr.open("DELETE", "https://jsonplaceholder.typicode.com/posts/" + id);
        xhr.setRequestHeader("content-type", "application/json; charset=UTF-8");
        xhr.send();

        xhr.onload = () => {
          if (xhr.status === 200) {
            console.log("Product deleted"); // 성공 메시지
            getProducts();
          } else {
            console.log(xhr.status, xhr.statusText);
          }
        };
      }
    </script>
  </head>

  <body>
    <h2>Products Management CRUD</h2>
    <button id="btnPro" style="font-size: 13px">Bring all products data</button>
    <div>
      <input type="text" id="name" size="10" placeholder="Title" />
      <input type="text" id="price" size="10" placeholder="Body" />
      <button id="btnAdd" type="button">Add Product</button>
    </div>
    <div
      id="contents"
      style="height: 1000px; background-color: lightgoldenrodyellow"
    ></div>
  </body>
</html>
